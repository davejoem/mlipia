"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../models/models");class s{constructor(e,s,t){this.mlipia=e,this.purview=s,this.events=[],this.register().then(()=>{1==t&&this.listen()})}add(s){return new Promise((t,i)=>{new e.Lender(this.mlipia).create(s).then(e=>{t(e)}).catch(e=>{i(e)})})}listen(){this.events.forEach(e=>{let s=this.purview+":"+e.name;this.mlipia.socket.on(s,e.func)})}register(){return Promise.resolve(()=>{this.events.push({func:this.list,name:this.purview+":list"}),this.events.push({func:this.add,name:this.purview+":add"})})}stopListening(){return Promise.resolve(()=>{this.events.forEach(e=>{let s=this.purview+":"+e.name;this.mlipia.socket.off(s)})})}list(e){return new Promise((s,t)=>{this.mlipia.models.Lender.find().exec().then(t=>{this.end(s,e,t)}).catch(s=>{this.end(t,e,{message:"Couldn't list lenders.",error:s})})})}end(e,s,t){e(t),s(t)}}exports.LendersEvents=s;