"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../models/models"),s=require("es6-promise");class t{constructor(e,s,t){this.mlipia=e,this.purview=s,this.events=[],this.register().then(()=>{1==t&&this.listen()})}add(t){return new s.Promise((s,i)=>{new e.Group(this.mlipia).create(t).then(e=>{s(e)}).catch(e=>{i(e)})})}listen(){this.events.forEach(e=>{let s=this.purview+":"+e.name;this.mlipia.socket.on(s,e.func)})}register(){return s.Promise.resolve(()=>{this.events.push({func:this.list,name:this.purview+":list"}),this.events.push({func:this.add,name:this.purview+":add"})})}stopListening(){return s.Promise.resolve(()=>{this.events.forEach(e=>{let s=this.purview+":"+e.name;this.mlipia.socket.off(s)})})}list(e){return new s.Promise((s,t)=>{this.mlipia.models.Group.find().exec().then(t=>{this.end(s,e,t)}).catch(s=>{this.end(t,e,{message:"Couldn't list groups.",error:s})})})}end(e,s,t){e(t),s(t)}}exports.GroupsEvents=t;